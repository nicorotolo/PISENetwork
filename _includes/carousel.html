{%- comment -%}  
Include per caroselli data-driven  
Parametri:  
  - id (obbligatorio): chiave in site.data.carousels  
  - folder (obbligatorio): nome della cartella in assets/images/  
  - title (facoltativo): titolo da mostrare sopra il carousel  
  - subtitle (facoltativo): sottotitolo / descrizione  
{%- endcomment -%}

{% assign items  = site.data.carousels[include.id] %}
{% assign folder = include.folder %}


<div class="carousel-section swiper-container swiper-{{ include.id }}">
  {%- if include.title %}
    <h2 class="carousel-title">{{ include.title }}</h2>
  {%- endif %}
  {%- if include.subtitle %}
    <p class="carousel-subtitle">{{ include.subtitle }}</p>
  {%- endif %}

  <div class="swiper-wrapper">
    {% for slide in items %}
      <div class="swiper-slide">
        <img
          src="{{ '/assets/images/' | append: folder | append: '/' | append: slide.src | relative_url }}"
          alt="{{ slide.alt }}"
        />
        {% if slide.caption %}
          <div class="swiper-caption">{{ slide.caption }}</div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
  <div class="swiper-pagination swiper-pagination-{{ include.id }}"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    new Swiper('.swiper-{{ include.id }}', {
      effect: 'coverflow',
      grabCursor: true,
      loop: true,
      centeredSlides: true,
      centeredSlidesBounds: true,          // <— importante per i bordi
      slidesPerView: 'auto',               // <— SEMPRE 'auto'
      spaceBetween: 16,
      loopAdditionalSlides: 2,
      coverflowEffect: {
        rotate: 0,
        stretch: 0,
        depth: 120,
        modifier: 1,
        slideShadows: false
      },
      autoplay: {
        delay: 3000,
        disableOnInteraction: false
      },
      pagination: {
        el: '.swiper-pagination-{{ include.id }}',
        clickable: true,
        renderBullet: (i, cls) => `<span class="${cls}"></span>`
      },
      watchSlidesProgress: true,
      on: {
        init: function() {
          this.slides.forEach(slide => {
            const img = slide.querySelector('img');
            if (!img) return;
            slide.classList.add(
              img.naturalWidth < img.naturalHeight ? 'portrait' : 'landscape'
            );
          });
        },
        resize: function() {
          this.update(); // ricalcola dimensioni su resize
        }
      }
    });
  });
</script>
